<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>psycare</title>
<link rel="stylesheet" href="login.css">
<style>
#formRegister { display:none; margin-top: 20px; }
</style>
</head>
<body>
<div class="container">
    <img src="img/LOGO1.png" alt="Logo">

    <!-- Login -->
    <form id="formLogin">
        <label for="loginEmail">Email:</label>
        <input type="text" id="loginEmail" required>
        <br>
        <label for="loginPassword">Password:</label>
        <input type="password" id="loginPassword" required>
        <br>
        <button type="submit">Login</button>
        <br>
        <button type="button" id="open">Cadastrar</button>
    </form>

    <!-- Registro -->
    <form id="formRegister">
        <label for="registerEmail">Email:</label>
        <input type="text" id="registerEmail" required>
        <br>
        <label for="registerName">New clinic:</label>
        <input type="text" id="registerName" required>
        <br>
        <label for="registerPassword">Password:</label>
        <input type="password" id="registerPassword" required>
        <br>
        <button type="submit">Register</button>
    </form>
</div>

<script>
const openRegister = document.getElementById('open');
const formCadastro = document.getElementById('formRegister');
const formLogin = document.getElementById('formLogin');

// Mostrar/Esconder formulário de registro
openRegister.addEventListener('click', () => {
    if (formCadastro.style.display === 'block') {
        formCadastro.style.display = 'none';
        formLogin.style.display = 'block';
    } else {
        formCadastro.style.display = 'block';
        formLogin.style.display = 'none';
    }
});

// Envio de Cadastro
formCadastro.addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = document.getElementById("registerName").value;
    const email = document.getElementById("registerEmail").value;
    const password = document.getElementById("registerPassword").value;

    try {
        const response = await fetch("/auth/register", { 
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, password })
        });

        const data = await response.json();
        alert(data.message);

        if (response.ok) {
            // Se deu certo, volta para o login
            formCadastro.style.display = 'none';
            formLogin.style.display = 'block';
            formCadastro.reset(); // Limpa os campos do cadastro
        }
    } catch (err) {
        console.error("Erro detalhado no cadastro:", err);
        alert("Não foi possível conectar ao servidor para realizar o cadastro.");
    }
});

// Envio de Login
formLogin.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    try {
        const response = await fetch("/auth/login", { // Adicionado /auth aqui também
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });

        const data = await response.json();
        alert(data.message);

        if (response.ok) {
              window.location.href = "/admin";
     
        }
    } catch (err) {
        console.error("Erro detalhado no login:", err);
        alert("Não foi possível conectar ao servidor para realizar o login.");
    }
});

</script>
</body>
</html>
